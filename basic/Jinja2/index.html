<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=ansible,wiki,ops,devops,auto,运维自动化><link href=https://ansible.leops.cn/basic/Jinja2/ rel=canonical><meta name=author content=lework><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.1.5"><title>12. Jinja2 模板语法 - Ansible wiki</title><link rel=stylesheet href=../../assets/stylesheets/main.21aed14c.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.196e0c26.min.css><meta name=theme-color content=#4051b5><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#12-jinja2 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://ansible.leops.cn title="Ansible wiki" class="md-header-nav__button md-logo" aria-label="Ansible wiki"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Ansible wiki </span> <span class="md-header-nav__topic md-ellipsis"> 12. Jinja2 模板语法 </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/leops-china/ansible-wiki/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> leops-china/ansible-wiki </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Introduction/ class="md-tabs__link md-tabs__link--active"> Ansible 入门 </a> </li> <li class=md-tabs__item> <a href=../../advanced/optimization/ class=md-tabs__link> Ansible 进阶 </a> </li> <li class=md-tabs__item> <a href=../../dev/ class=md-tabs__link> Ansible 开发 </a> </li> <li class=md-tabs__item> <a href=../../ui/ class=md-tabs__link> Ansible UI </a> </li> <li class=md-tabs__item> <a href=../../certification/ class=md-tabs__link> Ansible 认证 </a> </li> <li class=md-tabs__item> <a href=../../roles/ class=md-tabs__link> Ansible Roles </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://ansible.leops.cn title="Ansible wiki" class="md-nav__button md-logo" aria-label="Ansible wiki"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Ansible wiki </label> <div class=md-nav__source> <a href=https://github.com/leops-china/ansible-wiki/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> leops-china/ansible-wiki </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../resources/ class=md-nav__link> Ansible 资源 </a> </li> <li class=md-nav__item> <a href=../../appreciate/ class=md-nav__link> 赞赏支持 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Ansible 入门 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 入门" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"></span> Ansible 入门 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Introduction/ class=md-nav__link> 1. Ansible 介绍 </a> </li> <li class=md-nav__item> <a href=../Installation/ class=md-nav__link> 2. 安装 Ansible </a> </li> <li class=md-nav__item> <a href=../Quickstart/ class=md-nav__link> 3. 快速开始 </a> </li> <li class=md-nav__item> <a href=../Inventory/ class=md-nav__link> 4. 认识主机清单 </a> </li> <li class=md-nav__item> <a href=../Patterns/ class=md-nav__link> 5. Patterns 匹配 </a> </li> <li class=md-nav__item> <a href=../Ad-hoc/ class=md-nav__link> 6. 使用 ad-hoc 命令 </a> </li> <li class=md-nav__item> <a href=../Ansible-command/ class=md-nav__link> 7. 熟悉 ansible 命令 </a> </li> <li class=md-nav__item> <a href=../Playbook/ class=md-nav__link> 8. 使用 Playbook </a> </li> <li class=md-nav__item> <a href=../Include-roles/ class=md-nav__link> 9. 包含和角色 </a> </li> <li class=md-nav__item> <a href=../Variables/ class=md-nav__link> 10. 使用变量 </a> </li> <li class=md-nav__item> <a href=../Facts/ class=md-nav__link> 11. Facts 数据 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 12. Jinja2 模板语法 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 12. Jinja2 模板语法 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#jinja2 class=md-nav__link> jinja2 模版中的一些语法 </a> <nav class=md-nav aria-label="jinja2 模版中的一些语法"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 变量 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 注释 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 转义 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 空白控制 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 控制结构 </a> <nav class=md-nav aria-label=控制结构> <ul class=md-nav__list> <li class=md-nav__item> <a href=#for class=md-nav__link> For </a> </li> <li class=md-nav__item> <a href=#if class=md-nav__link> if 语句 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 过滤器 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 赋值 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 表达式 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 字面量 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 算术 </a> </li> <li class=md-nav__item> <a href=#python class=md-nav__link> Python对象方法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ansible-jinja2 class=md-nav__link> 在 ansible 中使用Jinja2 </a> <nav class=md-nav aria-label="在 ansible 中使用Jinja2"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 获取当前时间 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 过滤器 </a> <nav class=md-nav aria-label=过滤器> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 格式化数据过滤器 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 强制定义变量 </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 未定义的变量默认值 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 省略参数 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 列表过滤 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 数据集过滤 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 字典过滤 </a> </li> <li class=md-nav__item> <a href=#zip class=md-nav__link> zip 过滤 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 子元素过滤器 </a> </li> <li class=md-nav__item> <a href=#mac class=md-nav__link> 随机Mac地址过滤器 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 随机数过滤 </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 随机列表过滤 </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 数学 </a> </li> <li class=md-nav__item> <a href=#json class=md-nav__link> JSON查询过滤 </a> </li> <li class=md-nav__item> <a href=#ip class=md-nav__link> ip地址过滤 </a> </li> <li class=md-nav__item> <a href=#network-cli class=md-nav__link> Network CLI 过滤器 </a> </li> <li class=md-nav__item> <a href=#network-xml class=md-nav__link> Network XML 过滤器 </a> </li> <li class=md-nav__item> <a href=#network-vlan class=md-nav__link> Network VLAN 过滤器 </a> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 哈希过滤器 </a> </li> <li class=md-nav__item> <a href=#_25 class=md-nav__link> 合并散列 </a> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 提取过滤器 </a> </li> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 注释过滤 </a> </li> <li class=md-nav__item> <a href=#url class=md-nav__link> url 分割过滤器 </a> </li> <li class=md-nav__item> <a href=#_28 class=md-nav__link> 正则匹配 </a> </li> <li class=md-nav__item> <a href=#kubernetes class=md-nav__link> Kubernetes 过滤器 </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> 其他的常用过滤 </a> </li> <li class=md-nav__item> <a href=#_30 class=md-nav__link> 组合过滤器 </a> </li> <li class=md-nav__item> <a href=#product class=md-nav__link> Product 过滤器 </a> </li> <li class=md-nav__item> <a href=#debug class=md-nav__link> debug 过滤器 </a> </li> <li class=md-nav__item> <a href=#_31 class=md-nav__link> 字节转换 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_32 class=md-nav__link> 测试 </a> <nav class=md-nav aria-label=测试> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_33 class=md-nav__link> 测试语法 </a> </li> <li class=md-nav__item> <a href=#_34 class=md-nav__link> 测试字符串 </a> </li> <li class=md-nav__item> <a href=#_35 class=md-nav__link> 版本比较 </a> </li> <li class=md-nav__item> <a href=#_36 class=md-nav__link> 包含测试 </a> </li> <li class=md-nav__item> <a href=#_37 class=md-nav__link> 路径测试 </a> </li> <li class=md-nav__item> <a href=#_38 class=md-nav__link> 测试命令结果 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lookup class=md-nav__link> lookup 插件 </a> </li> <li class=md-nav__item> <a href=#if_1 class=md-nav__link> if 语句 </a> </li> <li class=md-nav__item> <a href=#for_1 class=md-nav__link> for 语句 </a> </li> <li class=md-nav__item> <a href=#when-jinja2 class=md-nav__link> 在 when 里使用 jinja2 表达式 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Conditionals-loop/ class=md-nav__link> 13. 条件判断与循环 </a> </li> <li class=md-nav__item> <a href=../Blocks/ class=md-nav__link> 14. Blocks </a> </li> <li class=md-nav__item> <a href=../Playbook-features/ class=md-nav__link> 15. Playbook 高级特性 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-16 type=checkbox id=nav-4-16> <label class=md-nav__link for=nav-4-16> 扩展阅读(深入必读) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=扩展阅读(深入必读) data-md-level=2> <label class=md-nav__title for=nav-4-16> <span class="md-nav__icon md-icon"></span> 扩展阅读(深入必读) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Reference/Yaml/ class=md-nav__link> 1. YAML 语法 </a> </li> <li class=md-nav__item> <a href=../Reference/Vaults/ class=md-nav__link> 2. Vaults 加密数据 </a> </li> <li class=md-nav__item> <a href=../Reference/Keywords/ class=md-nav__link> 3. 关键字使用 </a> </li> <li class=md-nav__item> <a href=../Reference/Module/ class=md-nav__link> 4. 模块索引 </a> </li> <li class=md-nav__item> <a href=../Reference/Config/ class=md-nav__link> 5. Ansible 配置 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-17 type=checkbox id=nav-4-17> <label class=md-nav__link for=nav-4-17> Windows <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Windows data-md-level=2> <label class=md-nav__title for=nav-4-17> <span class="md-nav__icon md-icon"></span> Windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Windows/manager-windows/ class=md-nav__link> 1. 管理 Windows 主机 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Ansible 进阶 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 进阶" data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"></span> Ansible 进阶 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/optimization/ class=md-nav__link> Ansible 优化 </a> </li> <li class=md-nav__item> <a href=../../advanced/ansible-config/ class=md-nav__link> Ansible 的常用设置 </a> </li> <li class=md-nav__item> <a href=../../advanced/best-practices/ class=md-nav__link> Ansible 最佳实践 </a> </li> <li class=md-nav__item> <a href=../../advanced/ansible-lint/ class=md-nav__link> 使用 Ansible-lint </a> </li> <li class=md-nav__item> <a href=../../advanced/dynamic-hosts/ class=md-nav__link> 使用动态主机 </a> </li> <li class=md-nav__item> <a href=../../advanced/dynamic-inventory/ class=md-nav__link> 使用动态主机管理云服务 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-7 type=checkbox id=nav-5-7> <label class=md-nav__link for=nav-5-7> Ansible 安全 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 安全" data-md-level=2> <label class=md-nav__title for=nav-5-7> <span class="md-nav__icon md-icon"></span> Ansible 安全 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/security/ class=md-nav__link> Ansible 控制节点安全 </a> </li> <li class=md-nav__item> <a href=../../advanced/security/firewall/ class=md-nav__link> - 节点安全: 防火墙设置 </a> </li> <li class=md-nav__item> <a href=../../advanced/security/ssh-2step/ class=md-nav__link> - 节点安全: ssh登录二次验证 </a> </li> <li class=md-nav__item> <a href=../../advanced/security/audit/ class=md-nav__link> - 节点安全: 命令审计 </a> </li> <li class=md-nav__item> <a href=../../advanced/security/vault-hosts/ class=md-nav__link> - 节点安全: 加密主机清单 </a> </li> <li class=md-nav__item> <a href=../../advanced/security/filter-command/ class=md-nav__link> 过滤 Ansible 危险指令 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-8 type=checkbox id=nav-5-8> <label class=md-nav__link for=nav-5-8> Ansible 实践 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 实践" data-md-level=2> <label class=md-nav__title for=nav-5-8> <span class="md-nav__icon md-icon"></span> Ansible 实践 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/practice/snippets/ class=md-nav__link> Ansible Task片段 </a> </li> <li class=md-nav__item> <a href=../../advanced/practice/jenkins-and-ansible/ class=md-nav__link> 在 Jenkins 中使用 Ansible </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../advanced/ara/ class=md-nav__link> 使用 ARA 记录 Ansible 执行结果 </a> </li> <li class=md-nav__item> <a href=../../advanced/ansible-cmdb/ class=md-nav__link> 使用 Ansible-cmdb </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Ansible 开发 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 开发" data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"></span> Ansible 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/ class=md-nav__link> Ansible 开发说明 </a> </li> <li class=md-nav__item> <a href=../../dev/ansible-architecture/ class=md-nav__link> Ansible 架构 </a> </li> <li class=md-nav__item> <a href=../../dev/pycharm-remote-development/ class=md-nav__link> 使用 PyCharm 远程开发 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-4 type=checkbox id=nav-6-4> <label class=md-nav__link for=nav-6-4> Ansible 调试 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 调试" data-md-level=2> <label class=md-nav__title for=nav-6-4> <span class="md-nav__icon md-icon"></span> Ansible 调试 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/debug/verbose-debug/ class=md-nav__link> 详细输出 </a> </li> <li class=md-nav__item> <a href=../../dev/debug/pdb/ class=md-nav__link> pdb 本地调试 </a> </li> <li class=md-nav__item> <a href=../../dev/debug/pycharm/ class=md-nav__link> PyCharm 远程调试 </a> </li> <li class=md-nav__item> <a href=../../dev/debug/module-debug/ class=md-nav__link> 模块调试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-5 type=checkbox id=nav-6-5> <label class=md-nav__link for=nav-6-5> Module 开发 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Module 开发" data-md-level=2> <label class=md-nav__title for=nav-6-5> <span class="md-nav__icon md-icon"></span> Module 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/modules/ class=md-nav__link> Module 开发说明 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/remote_copy/ class=md-nav__link> 创建一个简单的module </a> </li> <li class=md-nav__item> <a href=../../dev/modules/huawei-switch/ class=md-nav__link> module 示例: 连接华为交换机 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-outher-dev/ class=md-nav__link> module 示例: 其他语言开发 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-shell-dir/ class=md-nav__link> module 示例: dir </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-docker-facts/ class=md-nav__link> module 示例: docker_facts </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-wechat/ class=md-nav__link> module 示例: wechat </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-return/ class=md-nav__link> module 的返回值 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-doc/ class=md-nav__link> module 的帮助文档 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-architecture/ class=md-nav__link> module 架构 </a> </li> <li class=md-nav__item> <a href=../../dev/modules/module-utilities/ class=md-nav__link> module 工具类 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-6 type=checkbox id=nav-6-6> <label class=md-nav__link for=nav-6-6> Plugin 开发 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Plugin 开发" data-md-level=2> <label class=md-nav__title for=nav-6-6> <span class="md-nav__icon md-icon"></span> Plugin 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/plugins/ class=md-nav__link> Plugin 开发说明 </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Action-hello/ class=md-nav__link> Action 示例: hello </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Callback-BlackHole/ class=md-nav__link> Callback 示例: BlackHole </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Filter-split/ class=md-nav__link> Filter 示例: split </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Inventory-csv/ class=md-nav__link> Inventory 示例: csv </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Lookup-github-status/ class=md-nav__link> Lookup 示例: github_status </a> </li> <li class=md-nav__item> <a href=../../dev/plugins/Vars-csv-vars/ class=md-nav__link> Vars 示例: csv_vars </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-7 type=checkbox id=nav-6-7> <label class=md-nav__link for=nav-6-7> API 使用 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="API 使用" data-md-level=2> <label class=md-nav__title for=nav-6-7> <span class="md-nav__icon md-icon"></span> API 使用 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dev/api/ class=md-nav__link> API 使用说明 </a> </li> <li class=md-nav__item> <a href=../../dev/api/api-task/ class=md-nav__link> 使用 API 运行任务 </a> </li> <li class=md-nav__item> <a href=../../dev/api/api-playbook/ class=md-nav__link> 使用 API 运行 Palybook </a> </li> <li class=md-nav__item> <a href=../../dev/api/api-suitable/ class=md-nav__link> 使用 suitable </a> </li> <li class=md-nav__item> <a href=../../dev/api/api-ansible-runner/ class=md-nav__link> 使用 ansible runner </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Ansible UI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible UI" data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"></span> Ansible UI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ui/ class=md-nav__link> Ansible UI 说明 </a> </li> <li class=md-nav__item> <a href=../../ui/awx/ class=md-nav__link> Ansible Awx </a> </li> <li class=md-nav__item> <a href=../../ui/tower/ class=md-nav__link> Ansible Tower </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Ansible 认证 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 认证" data-md-level=1> <label class=md-nav__title for=nav-8> <span class="md-nav__icon md-icon"></span> Ansible 认证 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../certification/ class=md-nav__link> Ansible 认证说明 </a> </li> <li class=md-nav__item> <a href=../../certification/ex407-example/ class=md-nav__link> EX407 示例试题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class=md-nav__link for=nav-9> Ansible Roles <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible Roles" data-md-level=1> <label class=md-nav__title for=nav-9> <span class="md-nav__icon md-icon"></span> Ansible Roles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/ class=md-nav__link> Ansible roles 怎么用？ </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2 type=checkbox id=nav-9-2> <label class=md-nav__link for=nav-9-2> 认证 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=认证 data-md-level=2> <label class=md-nav__title for=nav-9-2> <span class="md-nav__icon md-icon"></span> 认证 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/auth/kerberos-client/ class=md-nav__link> kerberos-client </a> </li> <li class=md-nav__item> <a href=../../roles/auth/kerberos-server/ class=md-nav__link> kerberos-server </a> </li> <li class=md-nav__item> <a href=../../roles/auth/openldap/ class=md-nav__link> openldap </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-3 type=checkbox id=nav-9-3> <label class=md-nav__link for=nav-9-3> 系统环境 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=系统环境 data-md-level=2> <label class=md-nav__title for=nav-9-3> <span class="md-nav__icon md-icon"></span> 系统环境 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/env/ant/ class=md-nav__link> ant </a> </li> <li class=md-nav__item> <a href=../../roles/env/erlang/ class=md-nav__link> erlang </a> </li> <li class=md-nav__item> <a href=../../roles/env/go/ class=md-nav__link> go </a> </li> <li class=md-nav__item> <a href=../../roles/env/hostnames/ class=md-nav__link> hostnames </a> </li> <li class=md-nav__item> <a href=../../roles/env/java/ class=md-nav__link> java </a> </li> <li class=md-nav__item> <a href=../../roles/env/lua/ class=md-nav__link> lua </a> </li> <li class=md-nav__item> <a href=../../roles/env/mvn/ class=md-nav__link> mvn </a> </li> <li class=md-nav__item> <a href=../../roles/env/nodejs/ class=md-nav__link> nodejs </a> </li> <li class=md-nav__item> <a href=../../roles/env/openssh/ class=md-nav__link> openssh </a> </li> <li class=md-nav__item> <a href=../../roles/env/openssl/ class=md-nav__link> openssl </a> </li> <li class=md-nav__item> <a href=../../roles/env/os-init/ class=md-nav__link> os-init </a> </li> <li class=md-nav__item> <a href=../../roles/env/php/ class=md-nav__link> php </a> </li> <li class=md-nav__item> <a href=../../roles/env/python2.7/ class=md-nav__link> python2.7 </a> </li> <li class=md-nav__item> <a href=../../roles/env/repo-epel/ class=md-nav__link> repo-epel </a> </li> <li class=md-nav__item> <a href=../../roles/env/ruby/ class=md-nav__link> ruby </a> </li> <li class=md-nav__item> <a href=../../roles/env/sbt/ class=md-nav__link> sbt </a> </li> <li class=md-nav__item> <a href=../../roles/env/ssh-2fa/ class=md-nav__link> ssh-2fa </a> </li> <li class=md-nav__item> <a href=../../roles/env/ssh-keys/ class=md-nav__link> ssh-keys </a> </li> <li class=md-nav__item> <a href=../../roles/env/update-kernel/ class=md-nav__link> update-kernel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-4 type=checkbox id=nav-9-4> <label class=md-nav__link for=nav-9-4> WEB <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=WEB data-md-level=2> <label class=md-nav__title for=nav-9-4> <span class="md-nav__icon md-icon"></span> WEB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/web/nginx/ class=md-nav__link> nginx </a> </li> <li class=md-nav__item> <a href=../../roles/web/openresty/ class=md-nav__link> openresty </a> </li> <li class=md-nav__item> <a href=../../roles/web/tengine/ class=md-nav__link> tengine </a> </li> <li class=md-nav__item> <a href=../../roles/web/tomcat/ class=md-nav__link> tomcat </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5 type=checkbox id=nav-9-5> <label class=md-nav__link for=nav-9-5> 数据库 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=数据库 data-md-level=2> <label class=md-nav__title for=nav-9-5> <span class="md-nav__icon md-icon"></span> 数据库 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/database/memcached/ class=md-nav__link> memcached </a> </li> <li class=md-nav__item> <a href=../../roles/database/mongodb/ class=md-nav__link> mongodb </a> </li> <li class=md-nav__item> <a href=../../roles/database/mycat/ class=md-nav__link> mycat </a> </li> <li class=md-nav__item> <a href=../../roles/database/mysql/ class=md-nav__link> mysql </a> </li> <li class=md-nav__item> <a href=../../roles/database/mysql57/ class=md-nav__link> mysql57 </a> </li> <li class=md-nav__item> <a href=../../roles/database/redis/ class=md-nav__link> redis </a> </li> <li class=md-nav__item> <a href=../../roles/database/redis5/ class=md-nav__link> redis5 </a> </li> <li class=md-nav__item> <a href=../../roles/database/codis/ class=md-nav__link> codis </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6 type=checkbox id=nav-9-6> <label class=md-nav__link for=nav-9-6> 键值存储 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=键值存储 data-md-level=2> <label class=md-nav__title for=nav-9-6> <span class="md-nav__icon md-icon"></span> 键值存储 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/kv/consul/ class=md-nav__link> consul </a> </li> <li class=md-nav__item> <a href=../../roles/kv/etcd/ class=md-nav__link> etcd </a> </li> <li class=md-nav__item> <a href=../../roles/kv/zookeeper/ class=md-nav__link> zookeeper </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7 type=checkbox id=nav-9-7> <label class=md-nav__link for=nav-9-7> 大数据 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=大数据 data-md-level=2> <label class=md-nav__title for=nav-9-7> <span class="md-nav__icon md-icon"></span> 大数据 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/bigdata/airflow/ class=md-nav__link> airflow </a> </li> <li class=md-nav__item> <a href=../../roles/bigdata/cdh5-agent/ class=md-nav__link> cdh5-agent </a> </li> <li class=md-nav__item> <a href=../../roles/bigdata/cdh5-pre/ class=md-nav__link> cdh5-pre </a> </li> <li class=md-nav__item> <a href=../../roles/bigdata/cdh5-server/ class=md-nav__link> cdh5-server </a> </li> <li class=md-nav__item> <a href=../../roles/bigdata/hadoop-standalone/ class=md-nav__link> hadoop-standalone </a> </li> <li class=md-nav__item> <a href=../../roles/bigdata/superset/ class=md-nav__link> superset </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8 type=checkbox id=nav-9-8> <label class=md-nav__link for=nav-9-8> 消息系统 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=消息系统 data-md-level=2> <label class=md-nav__title for=nav-9-8> <span class="md-nav__icon md-icon"></span> 消息系统 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/mq/kafka/ class=md-nav__link> kafka </a> </li> <li class=md-nav__item> <a href=../../roles/mq/kafka-manager/ class=md-nav__link> kafka-manager </a> </li> <li class=md-nav__item> <a href=../../roles/mq/rabbitmq/ class=md-nav__link> rabbitmq </a> </li> <li class=md-nav__item> <a href=../../roles/mq/rocketmq/ class=md-nav__link> rocketmq </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-9 type=checkbox id=nav-9-9> <label class=md-nav__link for=nav-9-9> 持续集成/交付 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=持续集成/交付 data-md-level=2> <label class=md-nav__title for=nav-9-9> <span class="md-nav__icon md-icon"></span> 持续集成/交付 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/ci/deploy-image/ class=md-nav__link> deploy-image </a> </li> <li class=md-nav__item> <a href=../../roles/ci/deploy-static/ class=md-nav__link> deploy-static </a> </li> <li class=md-nav__item> <a href=../../roles/ci/deploy-supervisor/ class=md-nav__link> deploy-supervisor </a> </li> <li class=md-nav__item> <a href=../../roles/ci/deploy-tomcat/ class=md-nav__link> deploy-tomcat </a> </li> <li class=md-nav__item> <a href=../../roles/ci/jenkins/ class=md-nav__link> jenkins </a> </li> <li class=md-nav__item> <a href=../../roles/ci/nexus/ class=md-nav__link> nexus </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-10 type=checkbox id=nav-9-10> <label class=md-nav__link for=nav-9-10> 高可用 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=高可用 data-md-level=2> <label class=md-nav__title for=nav-9-10> <span class="md-nav__icon md-icon"></span> 高可用 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/ha/keepalived/ class=md-nav__link> keepalived </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-11 type=checkbox id=nav-9-11> <label class=md-nav__link for=nav-9-11> 代理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=代理 data-md-level=2> <label class=md-nav__title for=nav-9-11> <span class="md-nav__icon md-icon"></span> 代理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/proxy/haproxy/ class=md-nav__link> haproxy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-12 type=checkbox id=nav-9-12> <label class=md-nav__link for=nav-9-12> 监控 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=监控 data-md-level=2> <label class=md-nav__title for=nav-9-12> <span class="md-nav__icon md-icon"></span> 监控 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/monitor/grafana/ class=md-nav__link> grafana </a> </li> <li class=md-nav__item> <a href=../../roles/monitor/zabbix-agent/ class=md-nav__link> zabbix-agent </a> </li> <li class=md-nav__item> <a href=../../roles/monitor/zabbix-server/ class=md-nav__link> zabbix-server </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-13 type=checkbox id=nav-9-13> <label class=md-nav__link for=nav-9-13> 日志分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=日志分析 data-md-level=2> <label class=md-nav__title for=nav-9-13> <span class="md-nav__icon md-icon"></span> 日志分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/log/elasticsearch/ class=md-nav__link> elasticsearch </a> </li> <li class=md-nav__item> <a href=../../roles/log/filebeat/ class=md-nav__link> filebeat </a> </li> <li class=md-nav__item> <a href=../../roles/log/grokdebug/ class=md-nav__link> grokdebug </a> </li> <li class=md-nav__item> <a href=../../roles/log/kibana/ class=md-nav__link> kibana </a> </li> <li class=md-nav__item> <a href=../../roles/log/logstash/ class=md-nav__link> logstash </a> </li> <li class=md-nav__item> <a href=../../roles/log/heartbeat/ class=md-nav__link> heartbeat </a> </li> <li class=md-nav__item> <a href=../../roles/log/metricbeat/ class=md-nav__link> metricbeat </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-14 type=checkbox id=nav-9-14> <label class=md-nav__link for=nav-9-14> 存储 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=存储 data-md-level=2> <label class=md-nav__title for=nav-9-14> <span class="md-nav__icon md-icon"></span> 存储 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/storage/gluster/ class=md-nav__link> gluster </a> </li> <li class=md-nav__item> <a href=../../roles/storage/nfs/ class=md-nav__link> nfs </a> </li> <li class=md-nav__item> <a href=../../roles/storage/samba/ class=md-nav__link> samba </a> </li> <li class=md-nav__item> <a href=../../roles/storage/vsftpd/ class=md-nav__link> vsftpd </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-15 type=checkbox id=nav-9-15> <label class=md-nav__link for=nav-9-15> 容器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=容器 data-md-level=2> <label class=md-nav__title for=nav-9-15> <span class="md-nav__icon md-icon"></span> 容器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/container/docker-compose/ class=md-nav__link> docker-compose </a> </li> <li class=md-nav__item> <a href=../../roles/container/docker-swarm/ class=md-nav__link> docker-swarm </a> </li> <li class=md-nav__item> <a href=../../roles/container/docker/ class=md-nav__link> docker </a> </li> <li class=md-nav__item> <a href=../../roles/container/harbor/ class=md-nav__link> harbor </a> </li> <li class=md-nav__item> <a href=../../roles/container/kubernetes-bin/ class=md-nav__link> kubernetes-bin </a> </li> <li class=md-nav__item> <a href=../../roles/container/kubernetes/ class=md-nav__link> kubernetes </a> </li> <li class=md-nav__item> <a href=../../roles/container/shipyard/ class=md-nav__link> shipyard </a> </li> <li class=md-nav__item> <a href=../../roles/container/nomad/ class=md-nav__link> nomad </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-16 type=checkbox id=nav-9-16> <label class=md-nav__link for=nav-9-16> 数据同步 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=数据同步 data-md-level=2> <label class=md-nav__title for=nav-9-16> <span class="md-nav__icon md-icon"></span> 数据同步 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/sync/rsync/ class=md-nav__link> rsync </a> </li> <li class=md-nav__item> <a href=../../roles/sync/sersync/ class=md-nav__link> sersync </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-17 type=checkbox id=nav-9-17> <label class=md-nav__link for=nav-9-17> 运维管理 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=运维管理 data-md-level=2> <label class=md-nav__title for=nav-9-17> <span class="md-nav__icon md-icon"></span> 运维管理 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/ops/os-check/ class=md-nav__link> os-check </a> </li> <li class=md-nav__item> <a href=../../roles/ops/backup-file/ class=md-nav__link> backup-file </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-18 type=checkbox id=nav-9-18> <label class=md-nav__link for=nav-9-18> 其他 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=其他 data-md-level=2> <label class=md-nav__title for=nav-9-18> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/other/chrony/ class=md-nav__link> chrony </a> </li> <li class=md-nav__item> <a href=../../roles/other/confd/ class=md-nav__link> confd </a> </li> <li class=md-nav__item> <a href=../../roles/other/iptables/ class=md-nav__link> iptables </a> </li> <li class=md-nav__item> <a href=../../roles/other/ntp/ class=md-nav__link> ntp </a> </li> <li class=md-nav__item> <a href=../../roles/other/supervisor/ class=md-nav__link> supervisor </a> </li> <li class=md-nav__item> <a href=../../roles/other/vault/ class=md-nav__link> vault </a> </li> <li class=md-nav__item> <a href=../../roles/other/cfssl/ class=md-nav__link> cfssl </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#jinja2 class=md-nav__link> jinja2 模版中的一些语法 </a> <nav class=md-nav aria-label="jinja2 模版中的一些语法"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 变量 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 注释 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 转义 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 空白控制 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 控制结构 </a> <nav class=md-nav aria-label=控制结构> <ul class=md-nav__list> <li class=md-nav__item> <a href=#for class=md-nav__link> For </a> </li> <li class=md-nav__item> <a href=#if class=md-nav__link> if 语句 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 过滤器 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 赋值 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 表达式 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 字面量 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 算术 </a> </li> <li class=md-nav__item> <a href=#python class=md-nav__link> Python对象方法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ansible-jinja2 class=md-nav__link> 在 ansible 中使用Jinja2 </a> <nav class=md-nav aria-label="在 ansible 中使用Jinja2"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 获取当前时间 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 过滤器 </a> <nav class=md-nav aria-label=过滤器> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 格式化数据过滤器 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 强制定义变量 </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 未定义的变量默认值 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 省略参数 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 列表过滤 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 数据集过滤 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 字典过滤 </a> </li> <li class=md-nav__item> <a href=#zip class=md-nav__link> zip 过滤 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 子元素过滤器 </a> </li> <li class=md-nav__item> <a href=#mac class=md-nav__link> 随机Mac地址过滤器 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 随机数过滤 </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 随机列表过滤 </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 数学 </a> </li> <li class=md-nav__item> <a href=#json class=md-nav__link> JSON查询过滤 </a> </li> <li class=md-nav__item> <a href=#ip class=md-nav__link> ip地址过滤 </a> </li> <li class=md-nav__item> <a href=#network-cli class=md-nav__link> Network CLI 过滤器 </a> </li> <li class=md-nav__item> <a href=#network-xml class=md-nav__link> Network XML 过滤器 </a> </li> <li class=md-nav__item> <a href=#network-vlan class=md-nav__link> Network VLAN 过滤器 </a> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 哈希过滤器 </a> </li> <li class=md-nav__item> <a href=#_25 class=md-nav__link> 合并散列 </a> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 提取过滤器 </a> </li> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 注释过滤 </a> </li> <li class=md-nav__item> <a href=#url class=md-nav__link> url 分割过滤器 </a> </li> <li class=md-nav__item> <a href=#_28 class=md-nav__link> 正则匹配 </a> </li> <li class=md-nav__item> <a href=#kubernetes class=md-nav__link> Kubernetes 过滤器 </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> 其他的常用过滤 </a> </li> <li class=md-nav__item> <a href=#_30 class=md-nav__link> 组合过滤器 </a> </li> <li class=md-nav__item> <a href=#product class=md-nav__link> Product 过滤器 </a> </li> <li class=md-nav__item> <a href=#debug class=md-nav__link> debug 过滤器 </a> </li> <li class=md-nav__item> <a href=#_31 class=md-nav__link> 字节转换 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_32 class=md-nav__link> 测试 </a> <nav class=md-nav aria-label=测试> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_33 class=md-nav__link> 测试语法 </a> </li> <li class=md-nav__item> <a href=#_34 class=md-nav__link> 测试字符串 </a> </li> <li class=md-nav__item> <a href=#_35 class=md-nav__link> 版本比较 </a> </li> <li class=md-nav__item> <a href=#_36 class=md-nav__link> 包含测试 </a> </li> <li class=md-nav__item> <a href=#_37 class=md-nav__link> 路径测试 </a> </li> <li class=md-nav__item> <a href=#_38 class=md-nav__link> 测试命令结果 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lookup class=md-nav__link> lookup 插件 </a> </li> <li class=md-nav__item> <a href=#if_1 class=md-nav__link> if 语句 </a> </li> <li class=md-nav__item> <a href=#for_1 class=md-nav__link> for 语句 </a> </li> <li class=md-nav__item> <a href=#when-jinja2 class=md-nav__link> 在 when 里使用 jinja2 表达式 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/leops-china/ansible-wiki/edit/master/docs/basic/Jinja2.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=12-jinja2>12. Jinja2 模板语法<a class=headerlink href=#12-jinja2 title="Permanent link">&para;</a></h1> <p>Ansible使用 <a href=https://jinja.palletsprojects.com/ >Jinja2</a> 模板来启用动态表达式和对变量的访问。</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Jinja2 是一个 Python 的功能齐全的模板引擎。它有完整的 unicode 支持，一个可选 的集成沙箱执行环境，被广泛使用，以 BSD 许可证授权。</p> </div> <h2 id=jinja2>jinja2 模版中的一些语法<a class=headerlink href=#jinja2 title="Permanent link">&para;</a></h2> <blockquote> <p>关于 Jinja2 完整的中文说明 请移步：<a href=http://docs.jinkan.org/docs/jinja2/ >http://docs.jinkan.org/docs/jinja2/</a></p> </blockquote> <h3 id=_1>变量<a class=headerlink href=#_1 title="Permanent link">&para;</a></h3> <p>可以使用点<code>.</code>来访问变量的属性，作为替代，也可以使用下标语法<code>[]</code>, 下面2种方式效果是一样的</p> <div class=highlight><pre><span></span><code>{{ foo.bar }}

{{ foo[&#39;bar&#39;] }}
</code></pre></div> <p>如果变量或属性不存在，会返回一个未定义值。</p> <h3 id=_2>注释<a class=headerlink href=#_2 title="Permanent link">&para;</a></h3> <p>要把模板中一行的部分注释掉，默认使用 <code>{# ... #}</code>注释语法。</p> <h3 id=_3>转义<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <p>简单的使用单引号进行转义</p> <p>对于较大的段落，使用raw进行转义 <div class=highlight><pre><span></span><code>{% raw %}
     &lt;ul&gt;
     {% for item in seq %}
         &lt;li&gt;{{ item }}&lt;/li&gt;
     {% endfor %}
     &lt;/ul&gt;
 {% endraw %}
</code></pre></div></p> <p>包含 &gt; 、 &lt; 、 &amp; 或 " 字符的变量，必须要手动转义, 使用<code>e</code> 顾虑器可以转义这些。</p> <div class=highlight><pre><span></span><code>{{ user.username | e }} 
</code></pre></div> <h3 id=_4>空白控制<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <p>在开始或结束放置一个减号（ <code>-</code> ），可以移除块前或块后的空白。</p> <div class=highlight><pre><span></span><code>{% for item in seq -%}
    {{ item }}
{%- endfor %}

{%- if foo -%}...{% endif %}
</code></pre></div> <h3 id=_5>控制结构<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>控制结构指的是所有的那些可以控制程序流的东西 —— 条件（比如 if/elif/ekse ）、 for 循环、以及宏和块之类的东西。控制结构在默认语法中以 {% .. %} 块的形式 出现。</p> <h4 id=for>For<a class=headerlink href=#for title="Permanent link">&para;</a></h4> <p>遍历序列 <div class=highlight><pre><span></span><code>{% for user in users %}
  &lt;li&gt;{{ user.username|e }}&lt;/li&gt;
{% endfor %}
</code></pre></div></p> <p>迭代字典 <div class=highlight><pre><span></span><code>{% for key, value in my_dict.iteritems() %}
    &lt;dt&gt;{{ key|e }}&lt;/dt&gt;
    &lt;dd&gt;{{ value|e }}&lt;/dd&gt;
{% endfor %}
</code></pre></div></p> <p>循环 10 次迭代之后会终止处理 <div class=highlight><pre><span></span><code>{% for user in users %}

    {%- if loop.index &gt;= 10 %}{% break %}{% endif %}

{%- endfor %}
</code></pre></div></p> <p>条件过滤 <div class=highlight><pre><span></span><code>{% for dir in data_dirs if dir != &quot;/&quot; %}
data_dir = {{ dir }}
{% else %}
# no data dirs found
{% endfor %}
</code></pre></div></p> <p>在一个 for 循环块中你可以访问这些特殊的变量:</p> <table> <thead> <tr> <th align=left>变量</th> <th align=left>描述</th> </tr> </thead> <tbody> <tr> <td align=left>loop.index</td> <td align=left>当前循环迭代的次数（从 1 开始）</td> </tr> <tr> <td align=left>loop.index0</td> <td align=left>当前循环迭代的次数（从 0 开始）</td> </tr> <tr> <td align=left>loop.revindex</td> <td align=left>到循环结束需要迭代的次数（从 1 开始）</td> </tr> <tr> <td align=left>loop.revindex0</td> <td align=left>到循环结束需要迭代的次数（从 0 开始）</td> </tr> <tr> <td align=left>loop.first</td> <td align=left>如果是第一次迭代，为 True 。</td> </tr> <tr> <td align=left>loop.last</td> <td align=left>如果是最后一次迭代，为 True 。</td> </tr> <tr> <td align=left>loop.length</td> <td align=left>序列中的项目数。</td> </tr> <tr> <td align=left>loop.cycle</td> <td align=left>在一串序列间期取值的辅助函数</td> </tr> <tr> <td align=left>loop.depth</td> <td align=left>指示当前渲染在递归循环中的深度。 从1开始</td> </tr> <tr> <td align=left>loop.depth0</td> <td align=left>指示当前渲染在递归循环中的深度。 从0开始</td> </tr> <tr> <td align=left>loop.previtem</td> <td align=left>循环的上一个迭代中的项目。 在第一次迭代中未定义。</td> </tr> <tr> <td align=left>loop.nextitem</td> <td align=left>循环的以下迭代中的项目。 在上一次迭代期间未定义。</td> </tr> <tr> <td align=left>loop.changed(*val)</td> <td align=left>如果以前使用其他值调用（或根本未调用），则为true。</td> </tr> </tbody> </table> <h4 id=if>if 语句<a class=headerlink href=#if title="Permanent link">&para;</a></h4> <p>Jinja 中的 if 语句可比 Python 中的 if 语句。 <div class=highlight><pre><span></span><code>{% if kenny.sick %}
     Kenny is sick.
 {% elif kenny.dead %}
     You killed Kenny!  You bastard!!!
 {% else %}
     Kenny looks okay --- so far
 {% endif %}
</code></pre></div></p> <h4 id=_6>过滤器<a class=headerlink href=#_6 title="Permanent link">&para;</a></h4> <p>变量可以通过 过滤器 修改。过滤器与变量用管道符号（ <code>|</code> ）分割，并且也 可以用圆括号传递可选参数。多个过滤器可以链式调用，前一个过滤器的输出会被作为 后一个过滤器的输入。</p> <div class=highlight><pre><span></span><code>{{ name | striptags | title }} 
</code></pre></div> <p>过滤器段允许你在一块模板数据上应用常规 Jinja2 过滤器。只需要把代码用 filter 节包裹起来:</p> <div class=highlight><pre><span></span><code>{% filter upper %}
    This text becomes uppercase
{% endfilter %}
</code></pre></div> <h4 id=_7>赋值<a class=headerlink href=#_7 title="Permanent link">&para;</a></h4> <p>在代码块中，你也可以为变量赋值。在顶层的（块、宏、循环之外）赋值是可导出的，即 可以从别的模板中导入。</p> <p>赋值使用 set 标签，并且可以为多个变量赋值:</p> <div class=highlight><pre><span></span><code>{% set navigation = [(&#39;index.html&#39;, &#39;Index&#39;), (&#39;about.html&#39;, &#39;About&#39;)] %}

{% set key, value = call_something() %}
</code></pre></div> <h3 id=_8>表达式<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p><code>{% ... %}</code> 用于执行诸如 for 循环 或赋值的语句</p> <p><code>{{ ... }}</code> 把表达式的结果打印到模板上</p> <p><strong>if 表达式</strong></p> <p>一般的语法是<code>&lt;do something&gt; if &lt;something is true&gt; else &lt;do something else&gt;</code>。</p> <div class=highlight><pre><span></span><code>{{ &#39;[%s]&#39; % page.title if page.title is defined else &#39;undefined&#39; }}
</code></pre></div> <h3 id=_9>字面量<a class=headerlink href=#_9 title="Permanent link">&para;</a></h3> <p>表达式最简单的形式就是字面量。字面量表示诸如字符串和数值的 Python 对象。下面 的字面量是可用的:</p> <table> <thead> <tr> <th>值</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>"Hello World"</td> <td>双引号或单引号中间的一切都是字符串。无论何时你需要在模板中使用一个字 符串（比如函数调用、过滤器或只是包含或继承一个模板的参数），它们都是 有用的。</td> </tr> <tr> <td>42/42.23</td> <td>直接写下数值就可以创建整数和浮点数。如果有小数点，则为浮点数，否则为 整数。记住在 Python 里， 42 和 42.0 是不一样的。</td> </tr> <tr> <td>['list','of','objects']</td> <td>一对中括号括起来的东西是一个列表。列表用于存储和迭代序列化的数据。</td> </tr> <tr> <td>('tuple','of','values')</td> <td>元组与列表类似，只是你不能修改元组。如果元组中只有一个项，你需要以逗号 结尾它。元组通常用于表示两个或更多元素的项。更多细节见上面的例子。</td> </tr> <tr> <td>{dict':'of','key':'and','value':'pairs'}</td> <td>Python 中的字典是一种关联键和值的结构。键必须是唯一的，并且键必须只有一个 值。字典在模板中很少使用，罕用于诸如 <a href=http://docs.jinkan.org/docs/jinja2/templates.html#xmlattr>xmlattr()</a> 过滤器之类。</td> </tr> <tr> <td>true/false</td> <td>true 永远是 true ，而 false 始终是 false 。</td> </tr> </tbody> </table> <div class="admonition note 提示"> <p class=admonition-title>Note</p> <p>特殊常量 true 、 false 和 none 实际上是小写的。因为这在过去会导致 混淆，过去 True扩展为一个被认为false 的未定义的变量。所有的这三个 常量也可以被写成首字母大写（ True 、 False 和 None ）。尽管如此， 为了一致性（所有的 Jinja 标识符是小写的），你应该使用小写的版本。</p> </div> <h3 id=_10>算术<a class=headerlink href=#_10 title="Permanent link">&para;</a></h3> <p>Jinja 允许你用计算值。这在模板中很少用到，但是为了完整性允许其存在。支持下面的 运算符:</p> <table> <thead> <tr> <th>运算符</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>+</td> <td>把两个对象加到一起。通常对象是素质，但是如果两者是字符串或列表，你可以用这 种方式来衔接它们。无论如何这不是首选的连接字符串的方式！连接字符串见 ~ 运算符。 {{ 1 + 1 }} 等于 2 。</td> </tr> <tr> <td>-</td> <td>用第一个数减去第二个数。 {{ 3 - 2 }} 等于 1 。</td> </tr> <tr> <td>/</td> <td>对两个数做除法。返回值会是一个浮点数。 {{ 1 / 2 }} 等于 {{ 0.5 }} 。</td> </tr> <tr> <td>//</td> <td>对两个数做除法，返回整数商。 {{ 20 // 7 }} 等于 2 。</td> </tr> <tr> <td>%</td> <td>计算整数除法的余数。 {{ 11 % 7 }} 等于 4 。</td> </tr> <tr> <td>*</td> <td>用右边的数乘左边的操作数。 {{ 2 * 2 }} 会返回 4 。也可以用于重 复一个字符串多次。 {{ ‘=’ * 80 }} 会打印 80 个等号的横条。</td> </tr> <tr> <td>**</td> <td>取左操作数的右操作数次幂。 {{ 2**3 }} 会返回 8 。</td> </tr> </tbody> </table> <p><strong>比较运算符</strong> </p> <table> <thead> <tr> <th>运算符</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>==</td> <td>比较两个对象是否相等。</td> </tr> <tr> <td>!=</td> <td>比较两个对象是否不等。</td> </tr> <tr> <td>&gt;</td> <td>如果左边大于右边，返回 true 。</td> </tr> <tr> <td>&gt;=</td> <td>如果左边大于等于右边，返回 true 。</td> </tr> <tr> <td>&lt;</td> <td>如果左边小于右边，返回 true 。</td> </tr> <tr> <td>&lt;=</td> <td>如果左边小于等于右边，返回 true 。</td> </tr> </tbody> </table> <p><strong>逻辑运算符</strong></p> <p>对于 if 语句，在 for 过滤或 if 表达式中，它可以用于联合多个表达式:</p> <table> <thead> <tr> <th>运算符</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>and</td> <td>如果左操作数和右操作数同为真，返回 true 。</td> </tr> <tr> <td>or</td> <td>如果左操作数和右操作数有一个为真，返回 true 。</td> </tr> <tr> <td>not</td> <td>对一个表达式取反（见下）。</td> </tr> <tr> <td>(expr)</td> <td>表达式组。</td> </tr> </tbody> </table> <div class="admonition note 提示"> <p class=admonition-title>Note</p> <p>is 和 in 运算符同样支持使用中缀记法: foo is not bar 和 foo not in bar 而不是 not foo is bar 和 not foo in bar 。所有的 其它表达式需要前缀记法 not (foo and bar) 。</p> </div> <p><strong>其它运算符</strong></p> <p>下面的运算符非常有用，但不适用于其它的两个分类:</p> <table> <thead> <tr> <th>运算符</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>in</td> <td>运行序列/映射包含检查。如果左操作数包含于右操作数，返回 true 。比如 {{ 1 in[1,2,3] }} 会返回 true 。</td> </tr> <tr> <td>is</td> <td>运行一个 <a href=http://docs.jinkan.org/docs/jinja2/templates.html#tests>测试</a> 。</td> </tr> <tr> <td>|</td> <td>应用一个 <a href=http://docs.jinkan.org/docs/jinja2/templates.html#filters>过滤器</a> 。</td> </tr> <tr> <td>~</td> <td>把所有的操作数转换为字符串，并且连接它们。 {{ "Hello " ~ name ~ "!" }} 会返回（假设 name 值为 ''John' ） Hello John! 。</td> </tr> <tr> <td>()</td> <td>调用一个可调用量:{{ post.render() }} 。在圆括号中，你可以像在 python 中一样使用位置参数和关键字参数: {{ post.render(user, full=true) }} 。</td> </tr> <tr> <td>. / []</td> <td>获取一个对象的属性。</td> </tr> </tbody> </table> <h3 id=python>Python对象方法<a class=headerlink href=#python title="Permanent link">&para;</a></h3> <p>在模板中，也是可以使用python的对象方法</p> <p>字符串方法</p> <ul> <li>endswith: 用于判断字符串是否以指定后缀结尾，如果以指定后缀结尾返回True，否则返回False</li> <li>startswith: 用于检查字符串是否是以指定子字符串开头，如果是则返回 True，否则返回 False。</li> <li>split: 指定分隔符对字符串进行切片，默认为空格</li> <li>rsplit: 与split相同，但从字符串的末尾开始切片</li> <li>splitlines: 按照行('\r', '\r\n', \n')分隔，返回一个包含各行作为元素的列表</li> <li>upper: 返回全部大写的字符串</li> <li>lower: 返回全部小写的字符串</li> <li>capitalize: 将字符串的第一个字母变成大写,其他字母变小写</li> </ul> <p>列表方法</p> <ul> <li> <p>index 返回提供值的第一个索引位置</p> </li> <li> <p>count 统计某个元素在列表中出现的次数</p> </li> </ul> <p><strong>python 版本处理</strong></p> <p>在python2中，使用<code>dict.keys()</code>, <code>dict.values()</code>, <code>dict.items()</code> 返回字典的列表形式。但是在python3中，这些方法则返回字典形式</p> <div class=highlight><pre><span></span><code># Only works with Python 2
{{ hosts.keys() }}
# Works with both Python 2 and Python 3
{{ hosts.keys() | list }}
</code></pre></div> <p>在python2中，字典有<code>iterkeys()</code>, <code>itervalues()</code>, and <code>iteritems()</code>方法，但是在python3中这些方法被删除，python3则使用 <code>dict.keys()</code>, <code>dict.values()</code>, <code>dict.items()</code> </p> <div class=highlight><pre><span></span><code># Only works with Python 2
{{ hosts.iteritems() }}

# Works with both Python 2 and Python 3
{{ hosts.items() | list }}
</code></pre></div> <h2 id=ansible-jinja2>在 ansible 中使用Jinja2<a class=headerlink href=#ansible-jinja2 title="Permanent link">&para;</a></h2> <h3 id=_11>获取当前时间<a class=headerlink href=#_11 title="Permanent link">&para;</a></h3> <p>使用 <code>now()</code> jinja2 函数可以获取当前的时间</p> <div class=highlight><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">ansible localhost -m debug -a &quot;msg={{ now(utc=&#39;True&#39;,fmt=&#39;%H-%m-%d %T&#39;) }}&quot;</span>
</code></pre></div> <blockquote> <p>utc 参数可以开启utc时间， fmt参数为时间的格式化输出。</p> <p><code>{{ }}</code> 代表把表达式的结果打印到模板上</p> </blockquote> <h3 id=_12>过滤器<a class=headerlink href=#_12 title="Permanent link">&para;</a></h3> <p>Ansible中的过滤器来自<code>Jinja2</code>，用于在模板表达式中转换数据。</p> <p>过滤器与变量用管道符号 <code>|</code> 分割</p> <h4 id=_13>格式化数据过滤器<a class=headerlink href=#_13 title="Permanent link">&para;</a></h4> <p>更改数据格式，其结果是对应的字符串</p> <div class=highlight><pre><span></span><code>{{ some_variable | to_json }} 

{{ some_variable | to_yaml }}
</code></pre></div> <p>对于人类可读得输出</p> <div class=highlight><pre><span></span><code>{{ some_variable | to_nice_json }} 

{{ some_variable | to_nice_yaml }}
</code></pre></div> <p>还可以增加参数( new in 2.2)</p> <div class=highlight><pre><span></span><code>{{ some_variable | to_nice_json(indent=2) }}

{{ some_variable | to_nice_yaml(indent=8) }}

{{ some_variable | to_nice_yaml(indent=8, width=1337) }}
</code></pre></div> <blockquote> <p>indent 指定缩进字符数， width限制行数宽度</p> </blockquote> <p>从json字符串读取，其结果为json类型</p> <div class=highlight><pre><span></span><code>{{ some_variable | from_json }}
</code></pre></div> <p>从yaml字符串读取，其结果为yaml类型</p> <div class=highlight><pre><span></span><code>{{ some_variable | from_yaml }}
</code></pre></div> <p>示例：将json文件内容赋值给变量</p> <div class=highlight><pre><span></span><code>tasks:
  - shell: cat /some/path/to/file.json
    register: result

  - set_fact:
      myvar: &quot;{{ result.stdout | from_json }}&quot;
</code></pre></div> <p>使用`from_yaml_all 解析多段yaml字符串</p> <div class=highlight><pre><span></span><code><span class=nt>tasks</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>shell</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cat /some/path/to/multidoc-file.yaml</span>
    <span class=nt>register</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
      <span class=nt>msg</span><span class=p>:</span> <span class=s>&#39;{{</span><span class=nv> </span><span class=s>item</span><span class=nv> </span><span class=s>}}&#39;</span>
    <span class=nt>loop</span><span class=p>:</span> <span class=s>&#39;{{</span><span class=nv> </span><span class=s>result.stdout</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>from_yaml_all</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>list</span><span class=nv> </span><span class=s>}}&#39;</span>
</code></pre></div> <h4 id=_14>强制定义变量<a class=headerlink href=#_14 title="Permanent link">&para;</a></h4> <p>如果变量未定义，则来自 <strong>ansible</strong> 和 <strong>ansible.cfg</strong> 的默认行为为失败，但您可以将其关闭。</p> <div class=highlight><pre><span></span><code>{{ variable | mandatory }}
</code></pre></div> <h4 id=_15>未定义的变量默认值<a class=headerlink href=#_15 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>{{ result.cmd|default(5) }}

{{ lookup(&#39;env&#39;, &#39;MY_USER&#39;) | default(&#39;admin&#39;, true) }}

{{ lookup(&#39;env&#39;, &#39;MY_USER&#39;) | default(&#39;admin&#39;, false) }}
</code></pre></div> <p>如果变量未定义，则将默认值赋值给变量，如果希望变量值为空的时候也赋值，需将 <strong>default</strong> 第二个值为<code>true</code></p> <h4 id=_16>省略参数<a class=headerlink href=#_16 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">touch files with an optional mode</span>
  <span class=nt>file</span><span class=p>:</span>
    <span class=nt>dest</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>item.path</span><span class=nv> </span><span class=s>}}&quot;</span>
    <span class=nt>state</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">touch</span>
    <span class=nt>mode</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>item.mode</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>default(omit)</span><span class=nv> </span><span class=s>}}&quot;</span>
  <span class=nt>loop</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/foo</span>
    <span class="p p-Indicator">-</span> <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/bar</span>
    <span class="p p-Indicator">-</span> <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/baz</span>
      <span class=nt>mode</span><span class=p>:</span> <span class=s>&quot;0444&quot;</span>
</code></pre></div> <p>对于列表中的前两个文件，默认mode将由系统的umask确定，因为 <code>mode=parameter</code> 不会发送到文件模块，而最后得文件将接收<code>mode=0444</code>选项。</p> <h4 id=_17>列表过滤<a class=headerlink href=#_17 title="Permanent link">&para;</a></h4> <p>取最小的值 <div class=highlight><pre><span></span><code>{{ list1 | min }}
</code></pre></div></p> <p>取最大的值 <div class=highlight><pre><span></span><code>{{ [3, 4, 2] | max }}
</code></pre></div></p> <p>展平列表 <div class=highlight><pre><span></span><code>{{ [3, [4, 2] ] | flatten }}

{{ [3, [4, [2]] ] | flatten(levels=1) }}  # 展平第一级
</code></pre></div></p> <h4 id=_18>数据集过滤<a class=headerlink href=#_18 title="Permanent link">&para;</a></h4> <p>对列表唯一过滤 <div class=highlight><pre><span></span><code>{{ list1 | unique }}
</code></pre></div></p> <p>对两个列表去重合并 <div class=highlight><pre><span></span><code>{{ list1 | union(list2) }}
</code></pre></div></p> <p>对两个列表做交集 <div class=highlight><pre><span></span><code>{{ list1 | intersect(list2) }}
</code></pre></div></p> <p>找到两个列表差异部分(在list1 不在list2 的差异) <div class=highlight><pre><span></span><code>{{ list1 | difference(list2) }}
</code></pre></div></p> <p>找到两个列表都互相不在对方列表的部分 <div class=highlight><pre><span></span><code>{{ list1 | symmetric_difference(list2) }}
</code></pre></div></p> <h4 id=_19>字典过滤<a class=headerlink href=#_19 title="Permanent link">&para;</a></h4> <p>将字典变为列表</p> <div class=highlight><pre><span></span><code>{{ dict | dict2items }}
</code></pre></div> <p>返回的列表</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Application</span>
  <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">payment</span>
<span class="p p-Indicator">-</span> <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Environment</span>
  <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">dev</span>
</code></pre></div> <p>可指定列表<code>key/vaule</code>的名字</p> <div class=highlight><pre><span></span><code>{{ files | dict2items(key_name=&#39;file&#39;, value_name=&#39;path&#39;) }}
</code></pre></div> <p>将列表转换为字典</p> <div class=highlight><pre><span></span><code>{{ tags | items2dict }}
</code></pre></div> <p>返回的字典</p> <div class=highlight><pre><span></span><code><span class=nt>Application</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">payment</span>
<span class=nt>Environment</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">dev</span>
</code></pre></div> <p>可指定列表<code>key/vaule</code>的名字</p> <div class=highlight><pre><span></span><code>{{ tags | items2dict(key_name=&#39;key&#39;, value_name=&#39;value&#39;) }}
</code></pre></div> <h4 id=zip>zip 过滤<a class=headerlink href=#zip title="Permanent link">&para;</a></h4> <p>使用 <code>zip</code> 来合并其他列表</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">give me list combo of two lists</span>
  <span class=nt>debug</span><span class=p>:</span>
   <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>[1,2,3,4,5]</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>zip([&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;,&#39;f&#39;])</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>list</span><span class=nv> </span><span class=s>}}&quot;</span>

<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">give me shortest combo of two lists</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>[1,2,3]</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>zip([&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;,&#39;f&#39;])</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>list</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <p>使用 <code>zip_longest</code> 以元素最多为合并对象</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">give me longest combo of three lists , fill with X</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>[1,2,3]</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>zip_longest([&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;,&#39;f&#39;],</span><span class=nv> </span><span class=s>[21,</span><span class=nv> </span><span class=s>22,</span><span class=nv> </span><span class=s>23],</span><span class=nv> </span><span class=s>fillvalue=&#39;X&#39;)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>list</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <p>zip 也可以用于构造字典</p> <div class=highlight><pre><span></span><code>{{ dict(keys_list | zip(values_list)) }}
</code></pre></div> <p>变量</p> <div class=highlight><pre><span></span><code><span class=nt>keys_list</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">one</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">two</span>
<span class=nt>values_list</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apple</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">orange</span>
</code></pre></div> <p>转换后</p> <div class=highlight><pre><span></span><code><span class=nt>one</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">apple</span>
<span class=nt>two</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">orange</span>
</code></pre></div> <h4 id=_20>子元素过滤器<a class=headerlink href=#_20 title="Permanent link">&para;</a></h4> <p>使用<code>subelements</code> 过滤对象的子元素</p> <div class=highlight><pre><span></span><code>{{ users | subelements(&#39;groups&#39;, skip_missing=True) }}
</code></pre></div> <p>变量</p> <div class=highlight><pre><span></span><code><span class=nt>users</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">alice</span>
  <span class=nt>authorized</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/twokey.pub</span>
  <span class=nt>groups</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bob</span>
  <span class=nt>authorized</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/bob/id_rsa.pub</span>
  <span class=nt>groups</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
</code></pre></div> <p>转换后</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">alice</span>
    <span class=nt>groups</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
    <span class=nt>authorized</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/twokey.pub</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
<span class="p p-Indicator">-</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">alice</span>
    <span class=nt>groups</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">wheel</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
    <span class=nt>authorized</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/onekey.pub</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/alice/twokey.pub</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
<span class="p p-Indicator">-</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bob</span>
    <span class=nt>authorized</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/bob/id_rsa.pub</span>
    <span class=nt>groups</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker</span>
</code></pre></div> <p>一个在循环中使用的例子</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Set authorized ssh key, extracting just that data from &#39;users&#39;</span>
  <span class=nt>authorized_key</span><span class=p>:</span>
    <span class=nt>user</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>item.0.name</span><span class=nv> </span><span class=s>}}&quot;</span>
    <span class=nt>key</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>lookup(&#39;file&#39;,</span><span class=nv> </span><span class=s>item.1)</span><span class=nv> </span><span class=s>}}&quot;</span>
  <span class=nt>loop</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>users</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>subelements(&#39;authorized&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <h4 id=mac>随机Mac地址过滤器<a class=headerlink href=#mac title="Permanent link">&para;</a></h4> <p>从一个以<code>52:54:00</code>开头的字符串前缀中获取一个随机的MAC地址</p> <div class=highlight><pre><span></span><code>&quot;{{ &#39;52:54:00&#39; | random_mac }}&quot;
# =&gt; &#39;52:54:00:ef:1c:03&#39;
</code></pre></div> <p>使用因子，创建随机但幂等的MAC地址</p> <div class=highlight><pre><span></span><code>&quot;{{ &#39;52:54:00&#39; | random_mac(seed=inventory_hostname) }}&quot;
</code></pre></div> <h4 id=_21>随机数过滤<a class=headerlink href=#_21 title="Permanent link">&para;</a></h4> <p>从列表中随机获取元素 <div class=highlight><pre><span></span><code>{{ [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;,&#39;f&#39;]|random }}
</code></pre></div></p> <p>从0-59 的整数中随机获取一个数 <div class=highlight><pre><span></span><code>{{ 59 | random}}
</code></pre></div></p> <p>从0-100 中随机获取能被10 整除的数（可以理解为0 10 20 30 40 50 ...100 的随机数） <div class=highlight><pre><span></span><code>{{ 100 |random(step=10) }}
</code></pre></div></p> <p>从0-100 中随机获取1 开始步长为10 的数（可以理解为1 11 21 31 41...91 的随机数） <div class=highlight><pre><span></span><code>{{ 100 |random(1, 10) }}

{{ 100 |random(start=1, step=10) }}
</code></pre></div></p> <p>使用因子创建随机数</p> <div class=highlight><pre><span></span><code>&quot;{{ 60 | random(seed=inventory_hostname) }} * * * * root /script/from/cron&quot;
</code></pre></div> <h4 id=_22>随机列表过滤<a class=headerlink href=#_22 title="Permanent link">&para;</a></h4> <p>给已存在的列表随机排序 <div class=highlight><pre><span></span><code>{{ [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]|shuffle }} =&gt; [&#39;c&#39;,&#39;a&#39;,&#39;b&#39;]

{{ [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;]|shuffle }} =&gt; [&#39;b&#39;,&#39;c&#39;,&#39;a&#39;]
</code></pre></div></p> <p>使用因子生成随机列表</p> <div class=highlight><pre><span></span><code>{{ [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;] | shuffle(seed=inventory_hostname) }}
# =&gt; [&#39;b&#39;,&#39;a&#39;,&#39;c&#39;]
</code></pre></div> <h4 id=_23>数学<a class=headerlink href=#_23 title="Permanent link">&para;</a></h4> <p>获取对数, 默认<code>e</code> <div class=highlight><pre><span></span><code>{{ myvar | log }}

{{ myvar | log(10) }}
</code></pre></div></p> <p>获取n次幂 <div class=highlight><pre><span></span><code>{{ myvar | pow(2) }}

{{ myvar | pow(5) }}
</code></pre></div></p> <p>获取平方根 <div class=highlight><pre><span></span><code>{{ myvar | root }}

{{ myvar | root(5) }}
</code></pre></div></p> <h4 id=json>JSON查询过滤<a class=headerlink href=#json title="Permanent link">&para;</a></h4> <blockquote> <p>该过滤器基于jmespath构建 更多的示例 <a href=http://jmespath.org/examples.html>jmespath examples</a>.</p> </blockquote> <p>json过滤器，可以对复杂的json数据体提取一部分数据。</p> <p>json结构体</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
    <span class=nt>&quot;domain_definition&quot;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&quot;domain&quot;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&quot;cluster&quot;</span><span class=p>:</span> <span class=p>[</span>
                <span class=p>{</span>
                    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;cluster1&quot;</span>
                <span class=p>},</span>
                <span class=p>{</span>
                    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;cluster2&quot;</span>
                <span class=p>}</span>
            <span class=p>],</span>
            <span class=nt>&quot;server&quot;</span><span class=p>:</span> <span class=p>[</span>
                <span class=p>{</span>
                    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;server11&quot;</span><span class=p>,</span>
                    <span class=nt>&quot;cluster&quot;</span><span class=p>:</span> <span class=s2>&quot;cluster1&quot;</span><span class=p>,</span>
                    <span class=nt>&quot;port&quot;</span><span class=p>:</span> <span class=s2>&quot;8080&quot;</span>
                <span class=p>},</span>
                <span class=p>{</span>
                    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;server12&quot;</span><span class=p>,</span>
                    <span class=nt>&quot;cluster&quot;</span><span class=p>:</span> <span class=s2>&quot;cluster1&quot;</span><span class=p>,</span>
                    <span class=nt>&quot;port&quot;</span><span class=p>:</span> <span class=s2>&quot;8090&quot;</span>
                <span class=p>}</span>
            <span class=p>],</span>
            <span class=nt>&quot;library&quot;</span><span class=p>:</span> <span class=p>[</span>
                <span class=p>{</span>
                    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;lib1&quot;</span><span class=p>,</span>
                    <span class=nt>&quot;target&quot;</span><span class=p>:</span> <span class=s2>&quot;cluster1&quot;</span>
                <span class=p>},</span>
                <span class=p>{</span>
                    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;lib2&quot;</span><span class=p>,</span>
                    <span class=nt>&quot;target&quot;</span><span class=p>:</span> <span class=s2>&quot;cluster2&quot;</span>
                <span class=p>}</span>
            <span class=p>]</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>要从这个结构中提取所有<code>cluster</code>，可以使用以下查询</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;Display</span><span class=nv> </span><span class=s>all</span><span class=nv> </span><span class=s>cluster</span><span class=nv> </span><span class=s>names&quot;</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>var</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">item</span>
  <span class=nt>loop</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>domain_definition</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>json_query(&#39;domain.cluster[*].name&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <p>提取所有<code>server</code> 的 <code>name</code></p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;Display</span><span class=nv> </span><span class=s>all</span><span class=nv> </span><span class=s>server</span><span class=nv> </span><span class=s>names&quot;</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>var</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">item</span>
  <span class=nt>loop</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>domain_definition</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>json_query(&#39;domain.server[*].name&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <p>提取 <code>cluster1</code> 的 <code>port</code></p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;Display</span><span class=nv> </span><span class=s>all</span><span class=nv> </span><span class=s>ports</span><span class=nv> </span><span class=s>from</span><span class=nv> </span><span class=s>cluster1&quot;</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>var</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">item</span>
  <span class=nt>loop</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>domain_definition</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>json_query(server_name_cluster1_query)</span><span class=nv> </span><span class=s>}}&quot;</span>
  <span class=nt>vars</span><span class=p>:</span>
    <span class=nt>server_name_cluster1_query</span><span class=p>:</span> <span class=s>&quot;domain.server[?cluster==&#39;cluster1&#39;].port&quot;</span>
</code></pre></div> <p>使用字符串来连接端口</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;Display</span><span class=nv> </span><span class=s>all</span><span class=nv> </span><span class=s>ports</span><span class=nv> </span><span class=s>from</span><span class=nv> </span><span class=s>cluster1</span><span class=nv> </span><span class=s>as</span><span class=nv> </span><span class=s>a</span><span class=nv> </span><span class=s>string&quot;</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>domain_definition</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>json_query(&#39;domain.server[?cluster==`cluster1`].port&#39;)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>join(&#39;,</span><span class=nv> </span><span class=s>&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <blockquote> <p>这里使用反引号来避免转义</p> </blockquote> <p>可以使用单引号转义</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;Display</span><span class=nv> </span><span class=s>all</span><span class=nv> </span><span class=s>ports</span><span class=nv> </span><span class=s>from</span><span class=nv> </span><span class=s>cluster1&quot;</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>var</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">item</span>
  <span class=nt>loop</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>domain_definition</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>json_query(&#39;domain.server[?cluster==&#39;&#39;cluster1&#39;&#39;].port&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <h4 id=ip>ip地址过滤<a class=headerlink href=#ip title="Permanent link">&para;</a></h4> <p>测试字符串是有效的ip地址不</p> <div class=highlight><pre><span></span><code>{{ myvar | ipaddr }}
</code></pre></div> <p>字符串转ip协议地址</p> <div class=highlight><pre><span></span><code>{{ myvar | ipv4 }}

{{ myvar | ipv6 }}
</code></pre></div> <p>从cidr中获取地址信息</p> <div class=highlight><pre><span></span><code>{{ &#39;192.0.2.1/24&#39; | ipaddr(&#39;address&#39;) }}
</code></pre></div> <h4 id=network-cli>Network CLI 过滤器<a class=headerlink href=#network-cli title="Permanent link">&para;</a></h4> <p>使用<code>parse_cli</code>过滤器将网络设备CLI命令的输出转换为JSON输出</p> <div class=highlight><pre><span></span><code>{{ output | parse_cli(&#39;path/to/spec&#39;) }}
</code></pre></div> <p>还支持使用TextFSM库解析CLI命令的输出</p> <div class=highlight><pre><span></span><code>{{ output | parse_cli_textfsm(&#39;path/to/fsm&#39;) }}
</code></pre></div> <h4 id=network-xml>Network XML 过滤器<a class=headerlink href=#network-xml title="Permanent link">&para;</a></h4> <p>使用<code>parse_xml</code>过滤器将网络设备CLI命令的输出转换为XML输出</p> <div class=highlight><pre><span></span><code>{{ output | parse_xml(&#39;path/to/spec&#39;) }}
</code></pre></div> <h4 id=network-vlan>Network VLAN 过滤器<a class=headerlink href=#network-vlan title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>{{ [3003, 3004, 3005, 100, 1688, 3002, 3999] | vlan_parser }}
</code></pre></div> <p>输出</p> <div class=highlight><pre><span></span><code>[&#39;100,1688,3002-3005,3999&#39;]
</code></pre></div> <p>另一个jinja2模板例子</p> <div class=highlight><pre><span></span><code>{% set parsed_vlans = vlans | vlan_parser %}
switchport trunk allowed vlan {{ parsed_vlans[0] }}
{% for i in range (1, parsed_vlans | count) %}
switchport trunk allowed vlan add {{ parsed_vlans[i] }}
</code></pre></div> <h4 id=_24>哈希过滤器<a class=headerlink href=#_24 title="Permanent link">&para;</a></h4> <p>获取字符串得hash值 <div class=highlight><pre><span></span><code>{{ &#39;test1&#39;|hash(&#39;sha1&#39;) }}

{{ &#39;test1&#39;|hash(&#39;md5&#39;) }}
</code></pre></div></p> <p>获取字符串校验和 <div class=highlight><pre><span></span><code>{{ &#39;test2&#39;|checksum }}
</code></pre></div></p> <p>获取sha512密码哈希 <div class=highlight><pre><span></span><code>{{ &#39;passwordsaresecret&#39;|password_hash(&#39;sha512&#39;) }}

{{ &#39;secretpassword&#39;|password_hash(&#39;sha256&#39;, &#39;mysecretsalt&#39;) }}
</code></pre></div></p> <h4 id=_25>合并散列<a class=headerlink href=#_25 title="Permanent link">&para;</a></h4> <p><div class=highlight><pre><span></span><code>{{ {&#39;a&#39;:1, &#39;b&#39;:2}|combine({&#39;b&#39;:3}) }}
</code></pre></div> 结果 <div class=highlight><pre><span></span><code>{&#39;a&#39;:1, &#39;b&#39;:3}
</code></pre></div></p> <p>支持递归合并 <div class=highlight><pre><span></span><code>{{ {&#39;a&#39;:{&#39;foo&#39;:1, &#39;bar&#39;:2}, &#39;b&#39;:2}|combine({&#39;a&#39;:{&#39;bar&#39;:3, &#39;baz&#39;:4}}, recursive=True) }}
</code></pre></div></p> <p>结果 <div class=highlight><pre><span></span><code>{&#39;a&#39;:{&#39;foo&#39;:1, &#39;bar&#39;:3, &#39;baz&#39;:4}, &#39;b&#39;:2}
</code></pre></div></p> <h4 id=_26>提取过滤器<a class=headerlink href=#_26 title="Permanent link">&para;</a></h4> <p>使用 <code>map</code> <code>extract</code>筛选器将索引列表映射到容器中的值作为列表返回</p> <div class=highlight><pre><span></span><code>{{ [0,2]|map(&#39;extract&#39;, [&#39;x&#39;,&#39;y&#39;,&#39;z&#39;] )| list }}

# [&#39;x&#39;, &#39;z&#39;]
</code></pre></div> <div class=highlight><pre><span></span><code>{{ [&#39;x&#39;,&#39;y&#39;]|map(&#39;extract&#39;, {&#39;x&#39;: 42, &#39;y&#39;: 31})|list }}

# [42, 31]
</code></pre></div> <div class=highlight><pre><span></span><code>{{ groups[&#39;x&#39;]|map(&#39;extract&#39;, hostvars, &#39;ec2_ip_address&#39;)|list }}
</code></pre></div> <p>这需要组'x'中的主机列表，在主机中查找主机，然后查找结果的ec2_ip_address。 最后的结果是组'x'中的主机的IP地址列表。 <div class=highlight><pre><span></span><code>{{ groups[&#39;test&#39;] | map(&#39;extract&#39;, hostvars, &#39;ansible_default_ipv4.address&#39;)|list }}
</code></pre></div></p> <p>过滤器的第三个参数也可以是一个列表，用于容器内的递归查找：</p> <div class=highlight><pre><span></span><code>{{ [&#39;a&#39;]|map(&#39;extract&#39;, b, [&#39;x&#39;,&#39;y&#39;])|list }}

#  b[&#39;a&#39;][&#39;x&#39;][&#39;y&#39;]
</code></pre></div> <p>map中也可以使用其他过滤器</p> <div class=highlight><pre><span></span><code># 更改列表中的文件目录
{{ [&#39;/test/t.gz&#39;] | map(&#39;basename&#39;)| map(&#39;regex_replace&#39;, &#39;(.*)&#39;, &#39;/tmp/\\1&#39;) | list )}}
</code></pre></div> <h4 id=_27>注释过滤<a class=headerlink href=#_27 title="Permanent link">&para;</a></h4> <p><code>comment</code> 过滤器允许用选择的注释样式装饰文本。</p> <p><div class=highlight><pre><span></span><code>{{ &quot;Plain style (default)&quot; | comment }}
</code></pre></div> 输出 <div class=highlight><pre><span></span><code>#
# Plain style (default)
#
</code></pre></div></p> <p><strong>指定特定的注释字符</strong></p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">{{</span> <span class=s>&quot;My</span><span class=nv> </span><span class=s>Special</span><span class=nv> </span><span class=s>Case&quot;</span> <span class=err>|</span> <span class=nv>comment(decoration=&quot;! &quot;)</span> <span class="p p-Indicator">}}</span>
</code></pre></div> <p>输出</p> <div class=highlight><pre><span></span><code>!
! My Special Case
!
</code></pre></div> <p><strong>输出各种语言的注释风格</strong></p> <div class=highlight><pre><span></span><code>{{ &quot;C style&quot; | comment(&#39;c&#39;) }}
{{ &quot;C block style&quot; | comment(&#39;cblock&#39;) }}
{{ &quot;Erlang style&quot; | comment(&#39;erlang&#39;) }}
{{ &quot;XML style&quot; | comment(&#39;xml&#39;) }}
</code></pre></div> <p>还可以自定义 <div class=highlight><pre><span></span><code>{{ &quot;Custom style&quot; | comment(&#39;plain&#39;, prefix=&#39;#######\n#&#39;, postfix=&#39;#\n#######\n   ###\n    #&#39;) }}
</code></pre></div></p> <p>输出</p> <div class=highlight><pre><span></span><code>#######
#
# Custom style
#
#######
   ###
    #
</code></pre></div> <h4 id=url>url 分割过滤器<a class=headerlink href=#url title="Permanent link">&para;</a></h4> <p>使用 <code>urlsplit</code> 过滤器从url字符串中取其中的一个片段</p> <div class=highlight><pre><span></span><code>{{ &quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&quot; | urlsplit(&#39;hostname&#39;) }}
# =&gt; &#39;www.acme.com&#39;

{{ &quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&quot; | urlsplit(&#39;netloc&#39;) }}
# =&gt; &#39;user:password@www.acme.com:9000&#39;

{{ &quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&quot; | urlsplit(&#39;username&#39;) }}
# =&gt; &#39;user&#39;

{{ &quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&quot; | urlsplit(&#39;password&#39;) }}
# =&gt; &#39;password&#39;

{{ &quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&quot; | urlsplit(&#39;path&#39;) }}
# =&gt; &#39;/dir/index.html&#39;

{{ &quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&quot; | urlsplit(&#39;port&#39;) }}
# =&gt; &#39;9000&#39;

{{ &quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&quot; | urlsplit(&#39;scheme&#39;) }}
# =&gt; &#39;http&#39;

{{ &quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&quot; | urlsplit(&#39;query&#39;) }}
# =&gt; &#39;query=term&#39;

{{ &quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&quot; | urlsplit(&#39;fragment&#39;) }}
# =&gt; &#39;fragment&#39;

{{ &quot;http://user:password@www.acme.com:9000/dir/index.html?query=term#fragment&quot; | urlsplit }}
# =&gt;
#   {
#       &quot;fragment&quot;: &quot;fragment&quot;,
#       &quot;hostname&quot;: &quot;www.acme.com&quot;,
#       &quot;netloc&quot;: &quot;user:password@www.acme.com:9000&quot;,
#       &quot;password&quot;: &quot;password&quot;,
#       &quot;path&quot;: &quot;/dir/index.html&quot;,
#       &quot;port&quot;: 9000,
#       &quot;query&quot;: &quot;query=term&quot;,
#       &quot;scheme&quot;: &quot;http&quot;,
#       &quot;username&quot;: &quot;user&quot;
#   }
</code></pre></div> <h4 id=_28>正则匹配<a class=headerlink href=#_28 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code># search for &quot;foo&quot; in &quot;foobar&quot;
{{ &#39;foobar&#39; | regex_search(&#39;(foo)&#39;) }}

# will return empty if it cannot find a match
{{ &#39;ansible&#39; | regex_search(&#39;(foobar)&#39;) }}

# case insensitive search in multiline mode
{{ &#39;foo\nBAR&#39; | regex_search(&quot;^bar&quot;, multiline=True, ignorecase=True) }}
</code></pre></div> <p>搜索所有匹配的regex</p> <div class=highlight><pre><span></span><code># Return a list of all IPv4 addresses in the string
{{ &#39;Some DNS servers are 8.8.8.8 and 8.8.4.4&#39; | regex_findall(&#39;\\b(?:[0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#39;) }}
</code></pre></div> <p>正则替换</p> <div class=highlight><pre><span></span><code># convert &quot;ansible&quot; to &quot;able&quot;
{{ &#39;ansible&#39; | regex_replace(&#39;^a.*i(.*)$&#39;, &#39;a\\1&#39;) }}

# convert &quot;foobar&quot; to &quot;bar&quot;
{{ &#39;foobar&#39; | regex_replace(&#39;^f.*o(.*)$&#39;, &#39;\\1&#39;) }}

# convert &quot;localhost:80&quot; to &quot;localhost, 80&quot; using named groups
{{ &#39;localhost:80&#39; | regex_replace(&#39;^(?P&lt;host&gt;.+):(?P&lt;port&gt;\\d+)$&#39;, &#39;\\g&lt;host&gt;, \\g&lt;port&gt;&#39;) }}

# convert &quot;localhost:80&quot; to &quot;localhost&quot;
{{ &#39;localhost:80&#39; | regex_replace(&#39;:80&#39;) }}
</code></pre></div> <p>转义特殊字符</p> <div class=highlight><pre><span></span><code><span class=x># convert &#39;^f.*o(.*)$&#39; to &#39;\^f\.\*o\(\.\*\)\$&#39;</span>
<span class=cp>{{</span> <span class=s1>&#39;^f.*o(.*)$&#39;</span> <span class=o>|</span> <span class=nf>regex_escape</span><span class=o>()</span> <span class=cp>}}</span><span class=x></span>

<span class=x># convert &#39;^f.*o(.*)$&#39; to &#39;\^f\.\*o(\.\*)\$&#39;</span>
<span class=cp>{{</span> <span class=s1>&#39;^f.*o(.*)$&#39;</span> <span class=o>|</span> <span class=nf>regex_escape</span><span class=o>(</span><span class=s1>&#39;posix_basic&#39;</span><span class=o>)</span> <span class=cp>}}</span><span class=x></span>
</code></pre></div> <h4 id=kubernetes>Kubernetes 过滤器<a class=headerlink href=#kubernetes title="Permanent link">&para;</a></h4> <p>使用<code>k8s_config_resource_name</code>过滤器来获取Kubernetes ConfigMap或Secret的名称</p> <div class=highlight><pre><span></span><code>{{ configmap_resource_definition | k8s_config_resource_name }}
</code></pre></div> <h4 id=_29>其他的常用过滤<a class=headerlink href=#_29 title="Permanent link">&para;</a></h4> <p>为shell增加双引号</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>shell</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">echo {{ string_value | quote }}</span>
</code></pre></div> <p>根据True，False来返回值</p> <div class=highlight><pre><span></span><code>{{ (&#39;name&#39; == &#39;John&#39;) | ternary(&#39;Mr&#39;,&#39;Ms&#39;) }}

{{ enabled | ternary(&#39;no shutdown&#39;, &#39;shutdown&#39;, omit) }} # null 使用第三个值
</code></pre></div> <p>列表转换字符 <div class=highlight><pre><span></span><code>{{ list | join(&quot; &quot;) }}
</code></pre></div></p> <p>获取路径的文件名 <div class=highlight><pre><span></span><code>{{ path | basename }}
</code></pre></div></p> <p>获取文件的绝对路径 <div class=highlight><pre><span></span><code>{{ &#39;~/.ssh/id_rsa&#39; | expanduser }}
</code></pre></div></p> <p>windows平台下获取路径的文件名 <div class=highlight><pre><span></span><code>{{ path | win_basename }}
</code></pre></div></p> <p>获取路径中的目录 <div class=highlight><pre><span></span><code>{{ path | dirname }}
</code></pre></div></p> <p>展开包含环境变量的路径</p> <div class=highlight><pre><span></span><code>{{ path | expandvars }}
</code></pre></div> <p>获取软连接的真实路径</p> <div class=highlight><pre><span></span><code>{{ path | realpath }}

{{ path | relpath(&#39;/etc&#39;) }}  # 指定启点
</code></pre></div> <p>获取文件名的名称和扩展名 <div class=highlight><pre><span></span><code>{{ path | splitext }}
</code></pre></div></p> <p>base64编码 <div class=highlight><pre><span></span><code>{{ encoded | b64decode }}
{{ decoded | string | b64encode }}

{{ encoded | b64decode(encoding=&#39;utf-16-le&#39;) }}
{{ decoded | string | b64encode(encoding=&#39;utf-16-le&#39;) }}
</code></pre></div></p> <p>从字符串创建UUID（1.9版中的新功能） <div class=highlight><pre><span></span><code>{{ hostname | to_uuid }}
</code></pre></div></p> <p>将转换为布尔类型，如"True" 字符串转换为True <div class=highlight><pre><span></span><code>- debug: msg=test
 when: some_string_value | bool
</code></pre></div></p> <p>日期 <div class=highlight><pre><span></span><code># Get total amount of seconds between two dates. Default date format is %Y-%m-%d %H:%M:%S but you can pass your own format
{{ ((&quot;2016-08-14 20:00:12&quot; | to_datetime) - (&quot;2015-12-25&quot; | to_datetime(&#39;%Y-%m-%d&#39;))).total_seconds() }}

# Get remaining seconds after delta has been calculated. NOTE: This does NOT convert years, days, hours, etc to seconds. For that, use total_seconds()
{{ ((&quot;2016-08-14 20:00:12&quot; | to_datetime) - (&quot;2016-08-14 18:00:00&quot; | to_datetime)).seconds }}
# This expression evaluates to &quot;12&quot; and not &quot;132&quot;. Delta is 2 hours, 12 seconds

# get amount of days between two dates. This returns only number of days and discards remaining hours, minutes, and seconds
{{ ((&quot;2016-08-14 20:00:12&quot; | to_datetime) - (&quot;2015-12-25&quot; | to_datetime(&#39;%Y-%m-%d&#39;))).days }}
</code></pre></div></p> <p>格式化日期</p> <div class=highlight><pre><span></span><code># Display year-month-day
{{ &#39;%Y-%m-%d&#39; | strftime }}

# Display hour:min:sec
{{ &#39;%H:%M:%S&#39; | strftime }}

# Use ansible_date_time.epoch fact
{{ &#39;%Y-%m-%d %H:%M:%S&#39; | strftime(ansible_date_time.epoch) }}

# Use arbitrary epoch value
{{ &#39;%Y-%m-%d&#39; | strftime(0) }}          # =&gt; 1970-01-01
{{ &#39;%Y-%m-%d&#39; | strftime(1441357287) }} # =&gt; 2015-09-04
</code></pre></div> <p>查看变量的python类型</p> <div class=highlight><pre><span></span><code>{{ myvar | type }}
</code></pre></div> <h4 id=_30>组合过滤器<a class=headerlink href=#_30 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">give me largest permutations (order matters)</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>[1,2,3,4,5]</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>permutations</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>list</span><span class=nv> </span><span class=s>}}&quot;</span>

<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">give me permutations of sets of three</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>[1,2,3,4,5]</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>permutations(3)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>list</span><span class=nv> </span><span class=s>}}&quot;</span>

<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">give me combinations for sets of two</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>[1,2,3,4,5]</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>combinations(2)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>list</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <h4 id=product>Product 过滤器<a class=headerlink href=#product title="Permanent link">&para;</a></h4> <p><code>product</code>过滤器返回输入迭代的笛卡尔积。</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">generate multiple hostnames</span>
  <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>[&#39;foo&#39;,</span><span class=nv> </span><span class=s>&#39;bar&#39;]</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>product([&#39;com&#39;])</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>map(&#39;join&#39;,</span><span class=nv> </span><span class=s>&#39;.&#39;)</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>join(&#39;,&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <p>输出</p> <div class=highlight><pre><span></span><code><span class=p>{</span> <span class=nt>&quot;msg&quot;</span><span class=p>:</span> <span class=s2>&quot;foo.com,bar.com&quot;</span> <span class=p>}</span>
</code></pre></div> <h4 id=debug>debug 过滤器<a class=headerlink href=#debug title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>{{ myvar | type_debug }}
</code></pre></div> <h4 id=_31>字节转换<a class=headerlink href=#_31 title="Permanent link">&para;</a></h4> <p>将数字转换为人类可读的字符串</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;Human</span><span class=nv> </span><span class=s>Readable&quot;</span>
  <span class=nt>assert</span><span class=p>:</span>
    <span class=nt>that</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=s>&#39;&quot;1.00</span><span class=nv> </span><span class=s>Bytes&quot;</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>1|human_readable&#39;</span>
      <span class="p p-Indicator">-</span> <span class=s>&#39;&quot;1.00</span><span class=nv> </span><span class=s>bits&quot;</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>1|human_readable(isbits=True)&#39;</span>
      <span class="p p-Indicator">-</span> <span class=s>&#39;&quot;10.00</span><span class=nv> </span><span class=s>KB&quot;</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>10240|human_readable&#39;</span>
      <span class="p p-Indicator">-</span> <span class=s>&#39;&quot;97.66</span><span class=nv> </span><span class=s>MB&quot;</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>102400000|human_readable&#39;</span>
      <span class="p p-Indicator">-</span> <span class=s>&#39;&quot;0.10</span><span class=nv> </span><span class=s>GB&quot;</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>102400000|human_readable(unit=&quot;G&quot;)&#39;</span>
      <span class="p p-Indicator">-</span> <span class=s>&#39;&quot;0.10</span><span class=nv> </span><span class=s>Gb&quot;</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>102400000|human_readable(isbits=True,</span><span class=nv> </span><span class=s>unit=&quot;G&quot;)&#39;</span>
</code></pre></div> <p>返回</p> <div class=highlight><pre><span></span><code><span class=p>{</span> <span class=nt>&quot;changed&quot;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nt>&quot;msg&quot;</span><span class=p>:</span> <span class=s2>&quot;All assertions passed&quot;</span> <span class=p>}</span>
</code></pre></div> <p>以字节格式返回给定的字符串。</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class=s>&quot;Human</span><span class=nv> </span><span class=s>to</span><span class=nv> </span><span class=s>Bytes&quot;</span>
  <span class=nt>assert</span><span class=p>:</span>
    <span class=nt>that</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;{{&#39;0&#39;|human_to_bytes}}</span><span class=nv>        </span><span class=s>==</span><span class=nv> </span><span class=s>0&quot;</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;{{&#39;0.1&#39;|human_to_bytes}}</span><span class=nv>      </span><span class=s>==</span><span class=nv> </span><span class=s>0&quot;</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;{{&#39;0.9&#39;|human_to_bytes}}</span><span class=nv>      </span><span class=s>==</span><span class=nv> </span><span class=s>1&quot;</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;{{&#39;1&#39;|human_to_bytes}}</span><span class=nv>        </span><span class=s>==</span><span class=nv> </span><span class=s>1&quot;</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;{{&#39;10.00</span><span class=nv> </span><span class=s>KB&#39;|human_to_bytes}}</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>10240&quot;</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;{{</span><span class=nv>  </span><span class=s>&#39;11</span><span class=nv> </span><span class=s>MB&#39;|human_to_bytes}}</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>11534336&quot;</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>&#39;1.1</span><span class=nv> </span><span class=s>GB&#39;|human_to_bytes}}</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>1181116006&quot;</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;{{&#39;10.00</span><span class=nv> </span><span class=s>Kb&#39;|human_to_bytes(isbits=True)}}</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>10240&quot;</span>
</code></pre></div> <p>返回 <div class=highlight><pre><span></span><code><span class=p>{</span> <span class=nt>&quot;changed&quot;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nt>&quot;msg&quot;</span><span class=p>:</span> <span class=s2>&quot;All assertions passed&quot;</span> <span class=p>}</span>
</code></pre></div></p> <h3 id=_32>测试<a class=headerlink href=#_32 title="Permanent link">&para;</a></h3> <p>除了过滤器，所谓的“测试”也是可用的。测试可以用于对照普通表达式测试一个变量。 要测试一个变量或表达式，你要在变量后加上一个 is 以及测试的名称。例如，要得出 一个值是否定义过，你可以用 name is defined ，这会根据 name 是否定义返回 true 或 false 。</p> <h4 id=_33>测试语法<a class=headerlink href=#_33 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>variable is test_name
</code></pre></div> <p>例如</p> <div class=highlight><pre><span></span><code>result is failed
</code></pre></div> <p>测试也可以接受参数。如果测试只接受一个参数，你可以省去括号来分组它们。例如， 下面的两个表达式做同样的事情:</p> <div class=highlight><pre><span></span><code>{% if loop.index is divisibleby 3 %}
{% if loop.index is divisibleby(3) %}
</code></pre></div> <h4 id=_34>测试字符串<a class=headerlink href=#_34 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>vars:
  url: &quot;http://example.com/users/foo/resources/bar&quot;

tasks:
    - debug:
        msg: &quot;matched pattern 1&quot;
      when: url is match(&quot;http://example.com/users/.*/resources/.*&quot;)

    - debug:
        msg: &quot;matched pattern 2&quot;
      when: url is search(&quot;/users/.*/resources/.*&quot;)

    - debug:
        msg: &quot;matched pattern 3&quot;
      when: url is search(&quot;/users/&quot;)

    - debug:
        msg: &quot;matched pattern 4&quot;
      when: url is regex(&quot;example.com/\w+/foo&quot;)
</code></pre></div> <p><code>match</code>需要在字符串中完全匹配，而<code>search</code>只需要匹配字符串的子集。匹配成功返回<code>True</code>，任务则执行。</p> <h4 id=_35>版本比较<a class=headerlink href=#_35 title="Permanent link">&para;</a></h4> <p>检查ansible_distribution_version版本是否大于或等于'12 .04'，条件成立返回True。 <div class=highlight><pre><span></span><code>{{ ansible_distribution_version is version_compare(&#39;12.04&#39;, &#39;&gt;=&#39;) }}
</code></pre></div></p> <p>进行严格的版本检查 <div class=highlight><pre><span></span><code>{{ sample_version_var is version_compare(&#39;1.0&#39;, operator=&#39;lt&#39;, strict=True) }}
</code></pre></div> 可接受的运算符 <div class=highlight><pre><span></span><code>&lt;, lt, &lt;=, le, &gt;, gt, &gt;=, ge, ==, =, eq, !=, &lt;&gt;, ne
</code></pre></div></p> <h4 id=_36>包含测试<a class=headerlink href=#_36 title="Permanent link">&para;</a></h4> <p>测试一个列表是否包含另一个列表。</p> <div class=highlight><pre><span></span><code><span class=nt>vars</span><span class=p>:</span>
    <span class=nt>a</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=nv>1</span><span class="p p-Indicator">,</span><span class=nv>2</span><span class="p p-Indicator">,</span><span class=nv>3</span><span class="p p-Indicator">,</span><span class=nv>4</span><span class="p p-Indicator">,</span><span class=nv>5</span><span class="p p-Indicator">]</span>
    <span class=nt>b</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=nv>2</span><span class="p p-Indicator">,</span><span class=nv>3</span><span class="p p-Indicator">]</span>
<span class=nt>tasks</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
        <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;A</span><span class=nv> </span><span class=s>includes</span><span class=nv> </span><span class=s>B&quot;</span>
      <span class=nt>when</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">a is superset(b)</span>

    <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
        <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;B</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>included</span><span class=nv> </span><span class=s>in</span><span class=nv> </span><span class=s>A&quot;</span>
      <span class=nt>when</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">b is subset(a)</span>
</code></pre></div> <p>测试列表是否包含值</p> <div class=highlight><pre><span></span><code><span class=nt>vars</span><span class=p>:</span>
  <span class=nt>lacp_groups</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>master</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">lacp0</span>
      <span class=nt>network</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10.65.100.0/24</span>
      <span class=nt>gateway</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10.65.100.1</span>
      <span class=nt>dns4</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">10.65.100.10</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">10.65.100.11</span>
      <span class=nt>interfaces</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">em1</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">em2</span>

    <span class="p p-Indicator">-</span> <span class=nt>master</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">lacp1</span>
      <span class=nt>network</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10.65.120.0/24</span>
      <span class=nt>gateway</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10.65.120.1</span>
      <span class=nt>dns4</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">10.65.100.10</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">10.65.100.11</span>
      <span class=nt>interfaces</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">em3</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">em4</span>

<span class=nt>tasks</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
      <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>(lacp_groups|selectattr(&#39;interfaces&#39;,</span><span class=nv> </span><span class=s>&#39;contains&#39;,</span><span class=nv> </span><span class=s>&#39;em1&#39;)|first).master</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <p>您可以使用<code>any</code> 和 <code>all</code>来检查列表中的任何元素或所有元素是否为真</p> <div class=highlight><pre><span></span><code><span class=nt>vars</span><span class=p>:</span>
  <span class=nt>mylist</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>3</span><span class=nv> </span><span class=s>==</span><span class=nv> </span><span class=s>3</span><span class=nv> </span><span class=s>}}&quot;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
  <span class=nt>myotherlist</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class=nt>tasks</span><span class=p>:</span>

  <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
      <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;all</span><span class=nv> </span><span class=s>are</span><span class=nv> </span><span class=s>true!&quot;</span>
    <span class=nt>when</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mylist is all</span>

  <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
      <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;at</span><span class=nv> </span><span class=s>least</span><span class=nv> </span><span class=s>one</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>true&quot;</span>
    <span class=nt>when</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myotherlist is any</span>
</code></pre></div> <h4 id=_37>路径测试<a class=headerlink href=#_37 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>- debug:
    msg: &quot;path is a directory&quot;
  when: mypath is directory

- debug:
    msg: &quot;path is a file&quot;
  when: mypath is file

- debug:
    msg: &quot;path is a symlink&quot;
  when: mypath is link

- debug:
    msg: &quot;path already exists&quot;
  when: mypath is exists

- debug:
    msg: &quot;path is {{ (mypath is abs)|ternary(&#39;absolute&#39;,&#39;relative&#39;)}}&quot;

- debug:
    msg: &quot;path is the same file as path2&quot;
  when: mypath is same_file(path2)

- debug:
    msg: &quot;path is a mount&quot;
  when: mypath is mount
</code></pre></div> <h4 id=_38>测试命令结果<a class=headerlink href=#_38 title="Permanent link">&para;</a></h4> <p>以下playbook是检查任务状态的测试。</p> <div class=highlight><pre><span></span><code>tasks:

- shell: /usr/bin/foo
  register: result
  ignore_errors: True

- debug: msg=&quot;it failed&quot;
  when: result is failed

- debug: msg=&quot;it changed&quot;
  when: result is changed

- debug: msg=&quot;it succeeded in Ansible &gt;= 2.1&quot;
  when: result is succeeded

- debug: msg=&quot;it succeeded&quot;
  when: result is success

- debug: msg=&quot;it was skipped&quot;
  when: result is skipped
</code></pre></div> <h3 id=lookup>lookup 插件<a class=headerlink href=#lookup title="Permanent link">&para;</a></h3> <p><code>lookup</code> 插件允许访问外部数据源。</p> <div class=highlight><pre><span></span><code><span class=c1># 获取文件内容</span>
<span class=nt>vars</span><span class=p>:</span>
  <span class=nt>motd_value</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>lookup(&#39;file&#39;,</span><span class=nv> </span><span class=s>&#39;/etc/motd&#39;)</span><span class=nv> </span><span class=s>}}&quot;</span>
<span class=nt>tasks</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
      <span class=nt>msg</span><span class=p>:</span> <span class=s>&quot;motd</span><span class=nv> </span><span class=s>value</span><span class=nv> </span><span class=s>is</span><span class=nv> </span><span class=s>{{</span><span class=nv> </span><span class=s>motd_value</span><span class=nv> </span><span class=s>}}&quot;</span>
</code></pre></div> <p>lookup 更多的插件使用请看 <a href=/basic/Playbook-features/#lookup>lookup 插件</a></p> <h3 id=if_1>if 语句<a class=headerlink href=#if_1 title="Permanent link">&para;</a></h3> <p>ad-hoc <div class=highlight><pre><span></span><code>ansible localhost -m debug -a <span class=s2>&quot;msg={%- if ansible_play_hosts.index(inventory_hostname) &lt; 3 -%}master{%- else -%}slave{%- endif -%}&quot;</span> 
</code></pre></div></p> <p>playbook</p> <div class=highlight><pre><span></span><code><span class=nt>- debug</span><span class=p>:</span>
<span class=err>      </span><span class="l l-Scalar l-Scalar-Plain">msg</span><span class=err>: </span><span class="l l-Scalar l-Scalar-Plain">&gt;-</span>
<span class=err>        </span><span class="p p-Indicator">{</span><span class=err>%</span><span class=nv>-</span><span class=err> </span><span class=nv>if</span><span class=err> </span><span class=nv>ansible_play_hosts.index(inventory_hostname)</span><span class=err> </span><span class=nv>&lt;</span><span class=err> </span><span class=nv>3</span><span class=err> </span><span class=nv>-%</span><span class="p p-Indicator">}</span>
<span class=err>          </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class=err>        </span><span class="p p-Indicator">{</span><span class=err>%</span><span class=nv>-</span><span class=err> </span><span class=nv>else</span><span class=err> </span><span class=nv>-%</span><span class="p p-Indicator">}</span>
<span class=err>          </span><span class="l l-Scalar l-Scalar-Plain">slave</span>
<span class=err>        </span><span class="p p-Indicator">{</span><span class=err>%</span><span class=nv>-</span><span class=err> </span><span class=nv>endif</span><span class=err> </span><span class=nv>-%</span><span class="p p-Indicator">}</span>
</code></pre></div> <h3 id=for_1>for 语句<a class=headerlink href=#for_1 title="Permanent link">&para;</a></h3> <p>ad-hoc</p> <div class=highlight><pre><span></span><code>ansible localhost -m debug -a <span class=s2>&quot;msg={%- for t in [1,2,3] -%}{{ t }}{%- endfor -%}&quot;</span>
</code></pre></div> <p>playbook</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>debug</span><span class=p>:</span>
    <span class=nt>msg</span><span class=p>:</span> <span class="p p-Indicator">|-</span>
      <span class=no>{%- for t in [1,2,3] -%}</span>
        <span class=no>{{ t }}</span>
      <span class=no>{%- endfor -%}</span>
</code></pre></div> <h3 id=when-jinja2>在 when 里使用 jinja2 表达式<a class=headerlink href=#when-jinja2 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=err>- </span><span class="l l-Scalar l-Scalar-Plain">hosts</span><span class=err>: </span><span class="l l-Scalar l-Scalar-Plain">target_host</span>
  <span class="l l-Scalar l-Scalar-Plain">tasks</span><span class="p p-Indicator">:</span>
<span class=err>  - </span><span class="l l-Scalar l-Scalar-Plain">name</span><span class=err>: </span><span class="l l-Scalar l-Scalar-Plain">Show</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">debug</span>
<span class=err>    </span><span class="l l-Scalar l-Scalar-Plain">debug</span><span class=err>: </span><span class="l l-Scalar l-Scalar-Plain">msg=&#39;条件满足你就会看到我。&#39;</span>
<span class=err>    </span><span class="l l-Scalar l-Scalar-Plain">when</span><span class=err>: </span><span class="l l-Scalar l-Scalar-Plain">&#39;{%</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">if</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">def_a_var|d(&quot;abc&quot;)</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">==</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">&quot;abc&quot;</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">%}{{</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">foo</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">|</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">d(&quot;true&quot;)</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">}}{%</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">endif</span><span class=err> </span><span class="l l-Scalar l-Scalar-Plain">%}&#39;</span>
</code></pre></div> <hr> <div class=md-source-date> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2020-12-03 08:40:01</span> </small> </div> <h2 id=__comments>评论</h2> <div id=utteranc-comment></div> <script src=https://utteranc.es/client.js label=utteranc-comment repo=leops-china/ansible-wiki issue-term=pathname theme=github-light crossorigin=anonymous async>
	</script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../Facts/ class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> 上一页 </span> 11. Facts 数据 </div> </div> </a> <a href=../Conditionals-loop/ class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> 下一页 </span> 13. 条件判断与循环 </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 - 2020 leops </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/leops-china/ansible-wiki target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.7e0ee788.min.js></script> <script src=../../assets/javascripts/bundle.b3a72adc.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../..",
          features: ['navigation.tabs'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>